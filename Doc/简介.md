# KontaktMax 项目简介

## 1. 项目目标

**KontaktMax** 是一个使用现代Web技术栈构建的、跨平台的桌面应用程序，旨在为音乐制作人提供一个强大、直观的本地 **Native Instruments Kontakt 音源库管理工具**。

项目的核心目标是解决官方工具（Native Access）在管理大量自定义库、修复损坏的注册信息以及提供清晰的库状态概览方面的不足。

---

## 2. 技术栈

*   **核心框架**: [Tauri](https://tauri.app/) (v2) - 使用Rust作为后端，Web技术（HTML/CSS/TS）作为前端，构建轻量、安全、高性能的桌面应用。
*   **后端**: [Rust](https://www.rust-lang.org/) - 负责所有与操作系统交互的核心逻辑，如读取Windows注册表。
*   **前端**: [Vite](https://vitejs.dev/) + [TypeScript](https://www.typescriptlang.org/) - 提供现代化的、高效的前端开发体验。
*   **核心依赖**:
    *   `winreg` (Rust): 用于安全、高效地读取Windows注册表。
    *   `serde` (Rust): 用于在Rust后端和TypeScript前端之间序列化和反序列化数据。
    *   `@tauri-apps/api`: Tauri的前端JS API库，用于调用后端命令和窗口管理。
    *   `@tauri-apps/plugin-shell`: 用于调用系统原生功能，如打开文件浏览器。

---

## 3. 核心架构与工作流程

### 3.1. 前后端分离

项目采用标准的前后端分离架构：
*   **后端 (`src-tauri/`)**: 完全负责数据处理和系统交互。它提供了一系列可通过 `invoke` 调用的命令（例如 `get_installed_libraries`），但不关心这些数据如何被展示。
*   **前端 (`src/`)**: 完全负责UI的渲染和用户交互。它调用后端命令获取数据，然后将数据动态地渲染到HTML中。

### 3.2. 音源库发现与分类的核心逻辑

这是项目当前最核心的功能，其逻辑严格基于对现有专业工具的逆向工程分析：

1.  **混合模式发现**:
    *   **主索引优先**: 首先，程序会读取 `HKLM\SOFTWARE\WOW6432Node\Native Instruments\Content` 这个注册表项下的**所有值**，将其作为最权威的基础音源库列表。
    *   **全面普查补充**: 其次，程序会遍历以下三个关键路径下的**所有子项**，以发现那些可能注册信息不完整的“孤儿”库：
        1.  `HKLM\SOFTWARE\WOW6432Node\Native Instruments\`
        2.  `HKLM\SOFTWARE\Native Instruments\`
        3.  `HKCU\SOFTWARE\Native Instruments\`
    *   通过 `HashSet` 对两个来源的列表进行合并去重，得到最完整的音源库清单。

2.  **多层过滤机制**:
    *   在“全面普查”阶段，程序会根据一个内部嵌入的“黑名单” (`src-tauri/blacklist.json`) 进行**双重过滤**，排除掉所有已知的、非音源库的插件和工具（例如，根据`InstallVST64Dir`键值或`ALSupport`项名）。

3.  **类型分类**:
    *   对于最终列表中的每一个库，程序会去**最权威**的位置 `HKLM\SOFTWARE\WOW6432Node\Native Instruments\<库名>` 检查是否存在 `HU` 和 `JDX` 这两个键值，以将其精确分类为“标准音色库”或“自定义音色库”。

4.  **健康检查**:
    *   程序会检查每个库在上述三个关键路径下的注册情况，并返回一个 "X/3" 的状态字符串。

---

## 4. UI 概览

界面主要分为左右两个面板：

*   **左侧面板 (`.sheet-panel`)**:
    *   以一个可排序的表格，展示所有发现的音源库。
    *   包含三列：“音源库名称”、“类型”、“注册状态”。
    *   用户可以点击列头进行升序/降序排序。
*   **右侧面板 (`.side-panel`)**:
    *   **管理区 (`.manage-panel`)**: (功能待实现) 预留了添加和移除音色库的按钮。
    *   **信息区 (`.info-panel`)**:
        *   当用户在左侧表格中点击某一行时，此区域会被激活。
        *   采用**右侧垂直选项卡**布局，包含“概览”、“注册”、“更多”三个选项卡。
        *   支持**鼠标滚轮**在选项卡之间进行切换。
        *   **概览**: 显示音色库的文件目录路径，并支持点击后用系统文件浏览器打开。
        *   **注册**: 以表格形式，详细列出该库在系统三个关键位置的具体注册路径。

---

## 5. 如何开始

1.  **安装依赖**:
    ```bash
    npm install
    ```
2.  **启动开发环境**:
    ```bash
    npm run tauri dev
    ```
    应用将以调试模式启动，并开启热重载。

---

## 6. 关键文件导览

*   `src-tauri/src/lib.rs`: **(最重要)** 项目的后端核心，包含了所有音源库的发现、过滤和验证逻辑。
*   `src/main.ts`: **(次重要)** 前端的主入口，负责调用后端命令、处理用户交互（排序、点击、滚轮）、以及动态渲染所有UI组件。
*   `src/styles.css`: 项目的所有样式。
*   `index.html`: 应用的HTML骨架。
*   `src-tauri/tauri.conf.json`: Tauri应用的核心配置文件，定义了窗口外观、权限等。
*   `src-tauri/blacklist.json`: 用于过滤非音色库条目的黑名单。

